# Apache vhost for Firmware Maestro behind Kerberos/LDAP SSO
# Place in /etc/httpd/conf.d/ and adjust ServerName and paths.

<VirtualHost *:80>
    ServerName firmware.maestro.local

    WSGIDaemonProcess firmware_maestro user=apache group=apache threads=5 python-home=/opt/fm/venv
    WSGIScriptAlias / /opt/fm/FirmwareMaestro/wsgi.py

    <Directory /opt/fm/FirmwareMaestro>
        Require all granted
    </Directory>

    # -- Kerberos SSO via mod_auth_gssapi --
    AuthType GSSAPI
    AuthName "Firmware Maestro SSO"
    GssapiCredStore keytab:/etc/httpd/conf/krb5.keytab
    GssapiLocalName On
    Require valid-user

    # -- LDAP fallback via mod_authnz_ldap --
    <IfModule mod_authnz_ldap.c>
        AuthBasicProvider ldap
        AuthLDAPURL "ldap://idm.local/DC=local,DC=corp?sAMAccountName?sub?(objectClass=person)"
        AuthLDAPGroupAttribute member
        AuthLDAPGroupAttributeIsDN on
    </IfModule>

    ErrorLog logs/firmware_maestro_error.log
    CustomLog logs/firmware_maestro_access.log combined
</VirtualHost>
