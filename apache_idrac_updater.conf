# Apache vhost for iDrac Updater behind Kerberos/LDAP SSO
# Place in /etc/httpd/conf.d/ and adjust ServerName and paths.

<VirtualHost *:80>
    ServerName idrac-updater.local

    WSGIDaemonProcess idrac_updater user=apache group=apache threads=5 \
        python-home=/var/www/idrac_updater/venv
    WSGIScriptAlias / /var/www/idrac_updater/wsgi.py

    <Directory /var/www/idrac_updater>
        Require all granted

        # -- Kerberos SSO via mod_auth_gssapi --
        AuthType GSSAPI
        AuthName "iDrac Updater SSO"
        GssapiCredStore keytab:/etc/httpd/conf/krb5.keytab
        GssapiLocalName On
        Require valid-user

        # -- LDAP fallback via mod_authnz_ldap --
        <IfModule mod_authnz_ldap.c>
            AuthBasicProvider ldap
            AuthLDAPURL "ldap://idm.local/DC=local,DC=corp?sAMAccountName?sub?(objectClass=person)"
            AuthLDAPGroupAttribute member
            AuthLDAPGroupAttributeIsDN on
        </IfModule>
    </Directory>

    ErrorLog logs/idrac_updater_error.log
    CustomLog logs/idrac_updater_access.log combined
</VirtualHost>
